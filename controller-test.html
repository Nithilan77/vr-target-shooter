<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Quest 3 Controller Test - Desktop Simulation</title>
  <style>
    body { margin: 0; padding: 20px; background: #1a1a1a; color: #fff; font-family: Arial, sans-serif; }
    .container { max-width: 1200px; margin: 0 auto; }
    .header { text-align: center; margin-bottom: 30px; }
    .test-modes { display: flex; gap: 20px; margin-bottom: 30px; }
    .mode-card { background: #2a2a2a; padding: 20px; border-radius: 8px; flex: 1; }
    .mode-card h3 { margin-top: 0; color: #4CAF50; }
    .controller-display { display: flex; gap: 30px; margin-bottom: 30px; }
    .controller { background: #333; padding: 20px; border-radius: 8px; flex: 1; }
    .controller h4 { margin-top: 0; color: #2196F3; }
    .button-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
    .button { padding: 10px; border-radius: 4px; text-align: center; font-size: 12px; }
    .button.active { background: #4CAF50; color: white; }
    .button.inactive { background: #555; color: #ccc; }
    .axis-display { margin-bottom: 10px; }
    .axis-bar { width: 100%; height: 20px; background: #555; border-radius: 10px; position: relative; }
    .axis-value { height: 100%; background: #2196F3; border-radius: 10px; transition: width 0.1s; }
    .instructions { background: #2a2a2a; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
    .game-area { background: #333; height: 400px; border-radius: 8px; position: relative; overflow: hidden; margin-bottom: 20px; }
    canvas { display: block; width: 100%; height: 100%; }
    .controls-help { background: #1976D2; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
    .status { background: #424242; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üéÆ Quest 3 Controller Testing Suite</h1>
      <p>Test all Quest 3 controller features on your laptop using mouse, keyboard, or gamepad</p>
    </div>

    <div class="test-modes">
      <div class="mode-card">
        <h3>üñ±Ô∏è Mouse Mode</h3>
        <p><strong>Left Click:</strong> Trigger/Select<br>
        <strong>Right Click:</strong> Grip/Squeeze<br>
        <strong>Mouse Move:</strong> Controller aim<br>
        <strong>Scroll:</strong> Thumbstick</p>
      </div>
      <div class="mode-card">
        <h3>‚å®Ô∏è Keyboard Mode</h3>
        <p><strong>Space:</strong> Right Trigger<br>
        <strong>Enter:</strong> Left Trigger<br>
        <strong>Shift:</strong> Grip buttons<br>
        <strong>WASD:</strong> Left thumbstick<br>
        <strong>Arrow Keys:</strong> Right thumbstick</p>
      </div>
      <div class="mode-card">
        <h3>üéÆ Gamepad Mode</h3>
        <p><strong>RT/LT:</strong> Triggers<br>
        <strong>RB/LB:</strong> Grips<br>
        <strong>Sticks:</strong> Thumbsticks<br>
        <strong>A/X:</strong> Menu buttons</p>
      </div>
    </div>

    <div class="controls-help">
      <strong>üí° Pro Tip:</strong> Connect an Xbox or PlayStation controller for the most realistic Quest 3 simulation! 
      The gamepad triggers and thumbsticks will match the Quest 3 controller layout perfectly.
    </div>

    <div class="controller-display">
      <div class="controller">
        <h4>Left Controller</h4>
        <div class="button-grid">
          <div class="button inactive" id="left-trigger">Trigger</div>
          <div class="button inactive" id="left-grip">Grip</div>
          <div class="button inactive" id="left-menu">Menu</div>
          <div class="button inactive" id="left-thumbstick">Stick</div>
          <div class="button inactive" id="left-a">A</div>
          <div class="button inactive" id="left-b">B</div>
        </div>
        <div class="axis-display">
          <label>Thumbstick X: <span id="left-stick-x">0.00</span></label>
          <div class="axis-bar"><div class="axis-value" id="left-stick-x-bar"></div></div>
        </div>
        <div class="axis-display">
          <label>Thumbstick Y: <span id="left-stick-y">0.00</span></label>
          <div class="axis-bar"><div class="axis-value" id="left-stick-y-bar"></div></div>
        </div>
        <div class="axis-display">
          <label>Trigger: <span id="left-trigger-value">0.00</span></label>
          <div class="axis-bar"><div class="axis-value" id="left-trigger-bar"></div></div>
        </div>
      </div>

      <div class="controller">
        <h4>Right Controller</h4>
        <div class="button-grid">
          <div class="button inactive" id="right-trigger">Trigger</div>
          <div class="button inactive" id="right-grip">Grip</div>
          <div class="button inactive" id="right-menu">Menu</div>
          <div class="button inactive" id="right-thumbstick">Stick</div>
          <div class="button inactive" id="right-a">A</div>
          <div class="button inactive" id="right-b">B</div>
        </div>
        <div class="axis-display">
          <label>Thumbstick X: <span id="right-stick-x">0.00</span></label>
          <div class="axis-bar"><div class="axis-value" id="right-stick-x-bar"></div></div>
        </div>
        <div class="axis-display">
          <label>Thumbstick Y: <span id="right-stick-y">0.00</span></label>
          <div class="axis-bar"><div class="axis-value" id="right-stick-y-bar"></div></div>
        </div>
        <div class="axis-display">
          <label>Trigger: <span id="right-trigger-value">0.00</span></label>
          <div class="axis-bar"><div class="axis-value" id="right-trigger-bar"></div></div>
        </div>
      </div>
    </div>

    <div class="instructions">
      <h3>üéØ Mini Game Test Area</h3>
      <p>Use any input method above to control the red cursor. Try to hit the blue targets!</p>
    </div>

    <div class="game-area">
      <canvas id="gameCanvas"></canvas>
    </div>

    <div class="status" id="statusLog">
      Ready to test Quest 3 controller features... Try moving your mouse or pressing keys!
    </div>
  </div>

  <script>
    // Controller simulation state
    const controllers = {
      left: {
        trigger: 0,
        grip: false,
        menu: false,
        thumbstick: { x: 0, y: 0, pressed: false },
        a: false,
        b: false
      },
      right: {
        trigger: 0,
        grip: false,
        menu: false,
        thumbstick: { x: 0, y: 0, pressed: false },
        a: false,
        b: false
      }
    };

    // Game state
    const game = {
      cursor: { x: 400, y: 200 },
      targets: [],
      score: 0
    };

    // Canvas setup
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    function resizeCanvas() {
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // Mouse controls
    canvas.addEventListener('mousemove', (e) => {
      const rect = canvas.getBoundingClientRect();
      game.cursor.x = (e.clientX - rect.left) * (canvas.width / rect.width);
      game.cursor.y = (e.clientY - rect.top) * (canvas.height / rect.height);
      
      // Convert to controller thumbstick values
      controllers.right.thumbstick.x = (game.cursor.x / canvas.width - 0.5) * 2;
      controllers.right.thumbstick.y = (game.cursor.y / canvas.height - 0.5) * 2;
      
      updateDisplay();
      log('Mouse moved - Right thumbstick simulation');
    });

    canvas.addEventListener('mousedown', (e) => {
      if (e.button === 0) { // Left click
        controllers.right.trigger = 1;
        shoot();
        log('Left click - Right trigger pressed');
      } else if (e.button === 2) { // Right click
        controllers.right.grip = true;
        log('Right click - Right grip pressed');
      }
      updateDisplay();
    });

    canvas.addEventListener('mouseup', (e) => {
      if (e.button === 0) {
        controllers.right.trigger = 0;
        log('Left release - Right trigger released');
      } else if (e.button === 2) {
        controllers.right.grip = false;
        log('Right release - Right grip released');
      }
      updateDisplay();
    });

    canvas.addEventListener('contextmenu', (e) => e.preventDefault());

    // Keyboard controls
    document.addEventListener('keydown', (e) => {
      switch(e.key.toLowerCase()) {
        case ' ':
          controllers.right.trigger = 1;
          shoot();
          log('Space - Right trigger');
          break;
        case 'enter':
          controllers.left.trigger = 1;
          log('Enter - Left trigger');
          break;
        case 'shift':
          controllers.left.grip = true;
          controllers.right.grip = true;
          log('Shift - Both grips');
          break;
        case 'w':
          controllers.left.thumbstick.y = -1;
          log('W - Left stick up');
          break;
        case 's':
          controllers.left.thumbstick.y = 1;
          log('S - Left stick down');
          break;
        case 'a':
          controllers.left.thumbstick.x = -1;
          log('A - Left stick left');
          break;
        case 'd':
          controllers.left.thumbstick.x = 1;
          log('D - Left stick right');
          break;
        case 'arrowup':
          controllers.right.thumbstick.y = -1;
          moveCursor(0, -5);
          log('Arrow Up - Right stick up');
          break;
        case 'arrowdown':
          controllers.right.thumbstick.y = 1;
          moveCursor(0, 5);
          log('Arrow Down - Right stick down');
          break;
        case 'arrowleft':
          controllers.right.thumbstick.x = -1;
          moveCursor(-5, 0);
          log('Arrow Left - Right stick left');
          break;
        case 'arrowright':
          controllers.right.thumbstick.x = 1;
          moveCursor(5, 0);
          log('Arrow Right - Right stick right');
          break;
      }
      updateDisplay();
    });

    document.addEventListener('keyup', (e) => {
      switch(e.key.toLowerCase()) {
        case ' ':
          controllers.right.trigger = 0;
          break;
        case 'enter':
          controllers.left.trigger = 0;
          break;
        case 'shift':
          controllers.left.grip = false;
          controllers.right.grip = false;
          break;
        case 'w':
        case 's':
          controllers.left.thumbstick.y = 0;
          break;
        case 'a':
        case 'd':
          controllers.left.thumbstick.x = 0;
          break;
        case 'arrowup':
        case 'arrowdown':
          controllers.right.thumbstick.y = 0;
          break;
        case 'arrowleft':
        case 'arrowright':
          controllers.right.thumbstick.x = 0;
          break;
      }
      updateDisplay();
    });

    // Gamepad support
    function updateGamepads() {
      const gamepads = navigator.getGamepads();
      for (let i = 0; i < gamepads.length; i++) {
        const gp = gamepads[i];
        if (gp) {
          // Map gamepad to Quest 3 controllers
          controllers.left.trigger = gp.buttons[6] ? gp.buttons[6].value : 0; // LT
          controllers.right.trigger = gp.buttons[7] ? gp.buttons[7].value : 0; // RT
          controllers.left.grip = gp.buttons[4] ? gp.buttons[4].pressed : false; // LB
          controllers.right.grip = gp.buttons[5] ? gp.buttons[5].pressed : false; // RB
          
          // Thumbsticks
          controllers.left.thumbstick.x = gp.axes[0] || 0;
          controllers.left.thumbstick.y = gp.axes[1] || 0;
          controllers.right.thumbstick.x = gp.axes[2] || 0;
          controllers.right.thumbstick.y = gp.axes[3] || 0;
          
          // Move cursor with right stick
          moveCursor(controllers.right.thumbstick.x * 3, controllers.right.thumbstick.y * 3);
          
          // Shoot with trigger
          if (controllers.right.trigger > 0.5) {
            shoot();
          }
          
          updateDisplay();
          break;
        }
      }
    }

    // Game functions
    function moveCursor(dx, dy) {
      game.cursor.x = Math.max(0, Math.min(canvas.width, game.cursor.x + dx));
      game.cursor.y = Math.max(0, Math.min(canvas.height, game.cursor.y + dy));
    }

    function shoot() {
      // Check if cursor hits any targets
      game.targets = game.targets.filter(target => {
        const dx = game.cursor.x - target.x;
        const dy = game.cursor.y - target.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        if (distance < 30) {
          game.score++;
          log(`Target hit! Score: ${game.score}`);
          return false;
        }
        return true;
      });
    }

    function spawnTarget() {
      if (game.targets.length < 5) {
        game.targets.push({
          x: Math.random() * (canvas.width - 60) + 30,
          y: Math.random() * (canvas.height - 60) + 30,
          age: 0
        });
      }
    }

    // Render game
    function render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Draw targets
      ctx.fillStyle = '#2196F3';
      game.targets.forEach(target => {
        ctx.beginPath();
        ctx.arc(target.x, target.y, 25, 0, Math.PI * 2);
        ctx.fill();
        target.age++;
      });
      
      // Remove old targets
      game.targets = game.targets.filter(t => t.age < 300);
      
      // Draw cursor
      ctx.fillStyle = '#F44336';
      ctx.beginPath();
      ctx.arc(game.cursor.x, game.cursor.y, 8, 0, Math.PI * 2);
      ctx.fill();
      
      // Draw score
      ctx.fillStyle = '#fff';
      ctx.font = '24px Arial';
      ctx.fillText(`Score: ${game.score}`, 20, 40);
      
      // Spawn new targets occasionally
      if (Math.random() < 0.01) {
        spawnTarget();
      }
    }

    // Update display
    function updateDisplay() {
      // Update button states
      document.getElementById('left-trigger').className = controllers.left.trigger > 0 ? 'button active' : 'button inactive';
      document.getElementById('right-trigger').className = controllers.right.trigger > 0 ? 'button active' : 'button inactive';
      document.getElementById('left-grip').className = controllers.left.grip ? 'button active' : 'button inactive';
      document.getElementById('right-grip').className = controllers.right.grip ? 'button active' : 'button inactive';
      
      // Update axis values
      document.getElementById('left-stick-x').textContent = controllers.left.thumbstick.x.toFixed(2);
      document.getElementById('left-stick-y').textContent = controllers.left.thumbstick.y.toFixed(2);
      document.getElementById('right-stick-x').textContent = controllers.right.thumbstick.x.toFixed(2);
      document.getElementById('right-stick-y').textContent = controllers.right.thumbstick.y.toFixed(2);
      
      document.getElementById('left-trigger-value').textContent = controllers.left.trigger.toFixed(2);
      document.getElementById('right-trigger-value').textContent = controllers.right.trigger.toFixed(2);
      
      // Update bars
      document.getElementById('left-stick-x-bar').style.width = ((controllers.left.thumbstick.x + 1) / 2 * 100) + '%';
      document.getElementById('left-stick-y-bar').style.width = ((controllers.left.thumbstick.y + 1) / 2 * 100) + '%';
      document.getElementById('right-stick-x-bar').style.width = ((controllers.right.thumbstick.x + 1) / 2 * 100) + '%';
      document.getElementById('right-stick-y-bar').style.width = ((controllers.right.thumbstick.y + 1) / 2 * 100) + '%';
      
      document.getElementById('left-trigger-bar').style.width = (controllers.left.trigger * 100) + '%';
      document.getElementById('right-trigger-bar').style.width = (controllers.right.trigger * 100) + '%';
    }

    function log(message) {
      const statusLog = document.getElementById('statusLog');
      statusLog.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
    }

    // Main loop
    function gameLoop() {
      updateGamepads();
      render();
      requestAnimationFrame(gameLoop);
    }

    // Initialize
    spawnTarget();
    spawnTarget();
    gameLoop();
    updateDisplay();
    log('Quest 3 Controller Test Suite loaded! Try any input method.');
  </script>
</body>
</html>